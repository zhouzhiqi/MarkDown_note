### de巧lAB模型训练 
de巧lAB之前的一些后置CRF优化方法采用梯度下降法[67潤，而de巧lAB 
的后置CRF采用的是网格优化法，只有正向操作，没有误差反向传递过程，由 
每个参数序列生成结果，将结果最好的参数取值保存下来即为后的CRF参数 
不再改变，具体方法是将所有相关参数分别设定一个范围，然后选择合适的间距 
划分网格，对所有分立值采取循环遍历的形式，选择其中对训练样本有最高的整 
体正确率值的参数设定，并保留该参数作为CRF层的固定参数。 
28 
3.3基于边缘区域变换的DT网络 
3.3.1 DT 网络 
CNN衍生的FCN等对于场景语义分割十分有效，主要任务是对图像中的每 
个点分配一个类别标签。最近对FCN的后处理操作如加上全连接CRF能有效改 
善分割精度和物体边缘信息，全连接CRF的概率转移对双边滤波器的应用是对 
边缘敏感的，对中也点距离较近化及颜色相近的转移系数较大，表示可能有相同 
类别，实际应用过程中可以使分割结果比较符合物体的实际边缘[691。 
为了进一步较好的改善边缘信息，在使用deeplab的CRF之前，应用DT 
算法pw的递归方程在图像行列的序列信号上，该递归方程对边缘敏感，所有扩 
散在边缘处停止。区域变换即DT可以看做RNN网络的特例，可以方便的表示 
为gru单元。扩散操作与边缘强度图有密切关联，在标准DT模型中边缘强度 
由颜色梯度得到，但我们将从FCN中巧层学习得到该强度值，重要的是我们可 
w从端对端的训练中得到内部边缘网络的卷积核权重，w得到样本相关的边缘滤 
波器。 
DT网络[71惭模型由h部份组成，它们首尾并接的连接在一起训练，共同优 
化最后的分割结果的精度。第一个组件基于Vgg16[721结构的FCN8得到粗略的 
分割预测的得分。第二个细件被称为内部边缘网络，该网络利用FCN8的中间层 
得到的特征，这些特征层在被堆叠么前被会填充到同样的空间尺度，一个卷积核 
为1X1尺度的只有1个输出通道的卷积层被用来作为边缘强度预测，后接上 
RELU层用来使输出在0到1的范围。第三个组件是DT网络，这是一个保留边 
缘信息的滤波器，通过分别在行和列上套用一维递归滤波器实现高效的操作。尽 
管DT传统上用作普通的图像处理，我们用它来过滤粗略的FCN分割结果得分 
使其与物体边缘结合得更好，通过内部边缘网络得到的边缘强度图。 
3.3.2边缘区域变换算法 
DT (区域变换)网络需要2个输入，粗略的待滤波输入信号X，在我们的案 
例中就是FCN8得到的初步分割结果得分，另一个是正相关的区域变换转移密度 
信号d。输出信号是滤波后信号y。对于一维的n长度信号，如式(3.27)设置义＝ 
29  
并循环i＝2，.？n计算输出信号 
义＝(1 － w，批 ＋
 (3.27) 
权重wi取决于区域变换密度4？表示为式(3.28)： 
wJ. ＝ eXp(－怎dJ / 〇■：)
 (3.28) 
〇■，代表空间区域的卷积核标准差，区域变换密度4决定了扩散范围，通过 
控制X，和前一个滤波后信号义＿1的相加比例得到当前信号乂，wJ处于0到1的范 
围，控制点i－1到i的信号传递强度，如果di十分小，我们会得到全扩散，义＝乂＿1 
以及w，.＝l。另一个极端是4的值十分大，此时w，.＝0，扩散终止，导致义＝ 
可以见到一维信号如果只沿着一个方向如从左到右，那么下个信号将只取决 
于前一信号，为解决此问题可以从左到右和从右到左来滤波两次。 
对于二维信号的区域变换，在每个信号维度用一维滤波器循序的滤波，分别 
从上到下，从下到上，从左到右，从右到左四个方向顺序滤波，之后整体进行k 
次循环来减小误差。我们减小每次循环的DT卷积核的标准差，如式(3.巧)，每 
次第k次用〇■＆代替〇■，来计算wJ。 
2＾－＊ 
口k 二。S术一二、…，k
 (3.29) 
V4＾－l 
区域变换密度4定义为式(3.30)； 
4＝1 ＋ ＆ 鱼
 (3.30) 
＆代表边缘强度，是边缘强度图的卷积核标准差，＆越大，代表点i越 
可能是一个边缘点因此扩散在此终止，通用的DT网络使用颜色梯度如式(3.31)： 
＆二至11 ▽沪 ii
 (3.31) 
亡＝1 
我们的想法是通过反向传递输出y的分割误差到两个输入，这使得我们将 
DT转化为神经网络层，我们因此可以联合训练FCN8的粗略的分割结果X和边 
缘强度g的相关参数。 
我们假定每个点乂不仅影响接下来的点义＋1，还作为一个子层的输入，因此 
反向传递时除了考虑点少41的误差反传外也接受子层的反向误差。与标准的反向 
传播类似，我们反向递归套用式(3.32)到式(3.34)，更新参数y，w， X的相 
30 
应偏导数。 
苦吟w嘴
 (3.32) 
—4＾ old (―) ＋ (—
 (3.33) dwJ dwi
 妙i 
dl …8l、 dl 
—
￣
￣ 户 〇id(：＾—) ＋ wJ
 (3.34) 
如1 如 撕 
由于权重w，在四个方向的滤波中以及k次循环中都是共享的，所以每次的 
偏导数都应该相加作为整体。用这些偏导数我们能够得到边缘强度图的偏导 
数，通过链式规则得到＆的偏导数如下式所示，l表示目标误差函数。 
w， ＝eXp(－全(1 ＋ ＆ 鱼X)
 (3.35) 
口k
 口r 
dl 來 cXg dl 
—
二


 (3.36) 
诲 口k打r 献， 
这些偏导数之后会被传入内部边缘网络，这是用来得到边缘强度预测值的。 
我们还可以建立与口控RNN[73毕元的联系，该RNN起初用来分类序列文本数据， 
此RNN有如下规则 
义＝2，夾＋(1－2，此1
 (3.37) 
该式(3.37)中，Z，.＝l－w，.，yi ＝ X，.，Z，被定义为2，＝(7(乂)，乂 是激励信号， 
以及激励函数〇■的＝ l/(l ＋ e－＇)，因此可以得到DT中边缘强度图＆和激励信号乂 
的关系如下： 
各＇＝尹思 〇g(l ＋ ＾)－l)
 (3.3 巧 
3.4本章小结 
本章主要介绍了传统的CRF计算过程和CRF的基本原理和传统方法块特征 
提取的特征描述，介绍了强度，纹理，极化矩阵特征，然后介绍了基于后接全连 
接CRF计算的原理的deep加网络，描述了全连接CRF的计算过程，最后介绍 
DT网络的原理和其基本算法，不过其具体分析和改进留在第4章说明。 
31  
4 基于FCN－hed边缘和改进DT扩散模型的内部 
与外部融合的神经网络的分割模型 
4.1 FCN－hed边缘网络 
4丄1 FCN－hed的结构 
在自然图片中检测边缘和物体边界是个前沿且具有挑战的课题，这对于图像 
处理的多个领域如图像特征，图像分割，图像检测与识别，图像跟踪与动态分析， 
医学图像检测，3d重建，等至关重要，还可以用来实现自动驾驶，提升图像语 
文解析等现阶段应用。长期的实验证实自然图片的边缘定化由视觉感知的不同层 
级决定[74][75]。一个相关的感知实验[76h正明不同物体确实有某种程度上的不同指 
弓i，与其颜色上的边界和边缘的分布无关，也就是说两者实际边界间的颜色差距 
或者特征向量差距可能很小，即梯度很小，但人眼看来可认定为强边缘，通俗 
上说，比如一个同色圆形嵌入到两者颜色人眼刚刚能分出差别的一个同色矩形的 
中间，单从计算上边缘颜色梯度很小但从全局上讲可以看成很强的内部圆形达缘， 
另一种情况是一个人身上有不同颜色的衣服和裤子但我们看来其整个人身体周 
围的边缘是最显著的，之后才会注意到某个人衣服的内部分界线，而从算术意义 
上身体周围的颜色搏度可能不如衣服和裤子或其他部位的颜色梯度大。 
图像边缘检测有着悠久的历史，分为如下几类，第一，早期的工程学算子 
SoBelp7l cAnny算子[78]，第二，基于特征的信息论方法，如pB[76]， gpB[79]，第 
三基于人工特征的机器学习的如拙l[w]，Sketch tokenS[w，结构边缘法脚等。 
除此之外，最近出现的CNN潮流强调榜征的自动提取与学习，从而产生 
deepedget831，cSCNNt843等wCNN为基础的边缘提取方法。就目前来说，结构 
迈缘法有着目前综合上最好的效果。CNN的方法也有较大提升空间。 
FCN－hed[85骑应于对应于FCN网络，五个尺度的内部层分别后接对应尺度 
的反卷积层恢复到原图大小输出五个内部边缘层，结合所有五个边缘层后接卷积 
层输出化Se层，然后每个边缘层和fuSe层采取联合优化，权重都设为1，边缘层 
和fuSe层都统一依照边缘gt图进行训练。 
为了检测边缘采用了 一个端对端的边缘检测系统，命名为整体嵌套边缘检测 
32 
网络(肥0)。依靠卷积核的权重更新，它可1＾＞1自动学习丰富的层次特征，决定该 
特征是否重要对于模拟人的视觉来解决物体边界和边缘的抽象性。 
虽然没有湿式的结构性针对边缘检测输出建模，并没有向传统方法那挣特地 
寻求计算梯度值来比较！＾＞1分辨是不是边缘，整体的意思是利用61边缘图进行图 
对图的训练与预测。嵌套的意思是强调继承和提炼内部边缘图，通过综合所有的 
边缘输出可以得到更加精确的边缘预测。这种完整的基于多层次的可学习的特征 
架构比往的多尺度方法一是特征是学习出来的而不需要人为设定特征 
提取方式，二是多层次之间存在直接联系而不是分立存在。 
hed主要着重于解决两个关键问题，1)整体的图像训练和预测，基于FCN 
网络，进行图对图的分类，输入为完整的彩色图，输出为边缘强度图。2)嵌套 
的多层次特征学习，基于FCN的多层次结构决定，将所有5个尺度的持征层都作 
为内部边缘层产生边缘，再后接一个反卷积层恢复尺度。 
一系列卷积，池化，陆lu操作 
